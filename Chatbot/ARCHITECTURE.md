# CheeU RAG Pipeline μ•„ν‚¤ν…μ²

## π—οΈ μ‹μ¤ν… κµ¬μ΅°

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                 Streamlit UI                        β”‚
β”‚        μ‚¬μ©μ μ…λ ¥ | ν”„λ΅ν•„ μ •λ³΄ | κ²°κ³Ό ν‘μ‹          β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                          β”‚
                          β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                   API Layer                         β”‚
β”‚           quick_healing_message()                   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                          β”‚
                          β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                Pipeline Layer                       β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚ μ¤νΈλ μ¤λ¶„λ¥  β”‚β†’ β”‚  ν”„λ΅ν•„μƒμ„±   β”‚β†’β”‚  λ©”μ‹μ§€μƒμ„± β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                          β”‚
                          β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  Chatbot Engine                     β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚ VectorDBκ²€μƒ‰  β”‚β†’β”‚ ν”„λ΅¬ν”„νΈμƒμ„±  β”‚β†’β”‚  LLM νΈμ¶  β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                          β”‚
                          β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚               External Services                     β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚   ChromaDB   β”‚              β”‚   OpenAI API     β”‚ β”‚
β”‚  β”‚  (μ„λ² λ”©DB)  β”‚              β”‚   (GPT-4o)       β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π”„ λ°μ΄ν„° νλ¦„

### 1. μ…λ ¥ λ‹¨κ³„
```
μ‚¬μ©μ μ •λ³΄ μμ§‘
β”β”€β”€ κΈ°λ³Έμ •λ³΄: λ‹‰λ„¤μ„, λ‚μ΄, μ„±λ³„, μ§μ—…
β”β”€β”€ μ¤νΈλ μ¤ μ§€ν‘: μ°μΈ, λ¶μ•, μ§λ¬΄μ¤νΈλ μ¤
β”β”€β”€ μ„¤λ¬Έν‚¤μ›λ“: μ¦μƒ ν‚¤μ›λ“λ“¤
β””β”€β”€ μ‚¬μ©μ μ…λ ¥: κ³ λ―Ό λ‚΄μ©
```

### 2. μ¤νΈλ μ¤ μ ν• λ¶„λ¥
```python
Depression Γ— Anxiety Γ— Work_Stress = 8κ°€μ§€ μ ν•
```

| D | A | W | μ ν• | μΊλ¦­ν„° | μΉλ£λ²• |
|---|---|---|------|--------|---------|
| X | X | X | XXX | ν‰μ¨ν• π¦¥ | MBSR |
| O | X | X | OXX | μ°μΈν• π» | PPT+MBSR |
| X | O | X | XOX | λ¶μ•ν• π° | ACT+MBSR |
| X | X | O | XXO | μ§λ¬΄μ¤νΈλ μ¤ν• π¦” | ACT+CBT |
| O | O | X | OOX | μ°μΈ+λ¶μ•ν• π¦ | PPT+ACT+CBT |
| O | X | O | OXO | μ°μΈ+μ§λ¬΄ν• π¦« | PPT+ACT |
| X | O | O | XOO | λ¶μ•+μ§λ¬΄ν• πΏοΈ | ACT+CBT |
| O | O | O | OOO | μ„κΈ°ν• π¦ | PPT+ACT+DBT |

### 3. κ²€μƒ‰ μ „λµ (2λ‹¨κ³„ ν•„ν„°λ§)

#### 1μ°¨ ν•„ν„°λ§: μΉλ£λ²• λ²”μ„ μ ν•
```python
stress_type β†’ therapy_methods β†’ κ΄€λ ¨ λ…Όλ¬Έλ§
```

#### 2μ°¨ ν•„ν„°λ§: κ°μΈν™” κ²€μƒ‰
```python
main_query = user_input
sub_queries = [
    demographic_info,  # μ—°λ Ή+μ„±λ³„
    occupation_keywords,  # μ§κµ° ν‚¤μ›λ“
    survey_keywords  # μ„¤λ¬Έ ν‚¤μ›λ“
]
```

### 4. LLM ν”„λ΅¬ν”„νΈ κµ¬μ΅°

```
[μ‹μ¤ν… ν”„λ΅¬ν”„νΈ]
β”β”€β”€ μ‚¬μ©μ ν”„λ΅ν•„ μ»¨ν…μ¤νΈ
β”β”€β”€ VectorDB κ²€μƒ‰ κ²°κ³Ό (κ΄€λ ¨ λ…Όλ¬Έ)
β”β”€β”€ μ¤νΈλ μ¤ μ ν•λ³„ μΉλ£λ²• κ°€μ΄λ“
β””β”€β”€ μ¶λ ¥ ν•μ‹ μ§€μ •
    β”β”€β”€ π’ μΊ΅μ μƒ‰μƒ (μΉλ£λ²•λ³„)
    β”β”€β”€ π― ν•µμ‹¬ λ©”μ‹μ§€ (κ³µκ°+ν¬λ§)
    β”β”€β”€ π”§ μ‹¤μ² λ°©λ²• (3κ°€μ§€)
    β””β”€β”€ β­ κ²©λ ¤ λ¬Έκµ¬
```

## π― ν•µμ‹¬ νΉμ§•

### RAG (Retrieval-Augmented Generation)
- **Retrieval**: VectorDBμ—μ„ κ΄€λ ¨ λ…Όλ¬Έ κ²€μƒ‰
- **Augmentation**: κ²€μƒ‰ κ²°κ³Όλ¥Ό ν”„λ΅¬ν”„νΈμ— ν†µν•©
- **Generation**: GPT-4oλ΅ κ°μΈν™” λ©”μ‹μ§€ μƒμ„±

### κ°μΈν™” μ „λµ
1. **μ¤νΈλ μ¤ μ ν•**: 8κ°€μ§€ λ¶„λ¥
2. **μΉλ£λ²• λ§¤ν•‘**: μ ν•λ³„ μµμ  μΉλ£λ²•
3. **μΈκµ¬ν†µκ³„**: μ—°λ Ήλ€, μ„±λ³„
4. **μ§κµ° νΉν™”**: 24κ° NCS λ¶„λ¥
5. **μ„¤λ¬Έ ν‚¤μ›λ“**: κ°μΈ μ¦μƒ λ°μ

### μ„±λ¥ μµμ ν™”
- 2λ‹¨κ³„ ν•„ν„°λ§μΌλ΅ κ²€μƒ‰ λ²”μ„ μ¶•μ†
- μ°μ„ μμ„ κ°€μ¤‘μΉ κ²€μƒ‰
- κµ¬μ΅°ν™”λ ν”„λ΅¬ν”„νΈ
- μ¬μ‹λ„ λ΅μ§ (max_retries=3)

## π”§ κΈ°μ  μ¤νƒ

| κ³„μΈµ | κΈ°μ  | μ—­ν•  |
|------|------|------|
| Frontend | Streamlit | Web UI |
| Backend | Python 3.8+ | Business Logic |
| LLM | OpenAI GPT-4o | Text Generation |
| VectorDB | ChromaDB | Document Storage |
| Embedding | SentenceTransformers | Text Vectorization |
| Framework | LangChain | Pipeline Orchestration |

## π“ λ¨λ“λ³„ μ—­ν• 

### models.py
- λ°μ΄ν„° λ¨λΈ μ •μ
- μ¤νΈλ μ¤ μ ν• Enum
- μΉλ£λ²• μ •μ
- νλ¥΄μ†λ‚ ν‚¤μ›λ“

### pipeline.py
- λ©”μΈ μ¤μΌ€μ¤νΈλ μ΄μ…
- μ¤νΈλ μ¤ μ ν• κ²°μ •
- ν”„λ΅ν•„ μƒμ„±
- μ—λ¬ ν•Έλ“¤λ§

### chatbot.py
- LangChain ν†µν•©
- VectorDB κ²€μƒ‰
- ν”„λ΅¬ν”„νΈ μƒμ„±
- LLM νΈμ¶

### vectordb.py
- ChromaDB κ΄€λ¦¬
- μ„λ² λ”© μƒμ„±
- μ μ‚¬λ„ κ²€μƒ‰
- μ‹ λΆ°λ„ κ³„μ‚°

### api.py
- κ°„νΈ API ν•¨μ
- μ‹±κΈ€ν†¤ νμ΄ν”„λΌμΈ
- νλΌλ―Έν„° κ²€μ¦
